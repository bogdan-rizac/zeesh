# creates (if necessary) and copies a public key for ssh authentication to a remote host
function setup_pubkey() {
	if [ $1 ]; then
        a=("${(s/@/)1}") # split $1 by @
        local username=$a[1]
        local host=$a[2]
        # fix perms
        echo "Setting permissions to 700 for ~/.ssh"
        chmod 700 ~/.ssh
        echo "Copying pubkey to remote host. Please enter your password when prompted."
        # create pubkey if necessary
		[ -f ~/.ssh/id_rsa.pub ] || ssh-keygen -t rsa -q -f ~/.ssh/id_rsa -N ''
        # handle port in cmd if necessary
        if [ $2 ]; then
            ssh -q -p $2 $username@$host 'mkdir ~/.ssh'
            ssh -q -p $2 $username@$host 'touch ~/.ssh/authorized_keys'
        	cat ~/.ssh/id_rsa.pub | ssh -q -p $2 $username@$host 'cat >> ~/.ssh/authorized_keys'
        else
            ssh -q $username@$host 'mkdir ~/.ssh'
            ssh -q $username@$host 'touch ~/.ssh/authorized_keys'
        	cat ~/.ssh/id_rsa.pub | ssh -q $username@$host 'cat >> ~/.ssh/authorized_keys'
        fi
	else
		echo 'usage: create_pubkey username@host <port>'
	fi
}
