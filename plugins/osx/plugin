### osx / zeesh! plugin

fpath=( ~/.zsh/plugins/osx/func $fpath )
autoload -U ~/.zsh/plugins/osx/func/*(:t)

compctl -K list-sysctls sysctl

## exports
export LSCOLORS=ExfxcxdxbxegedabagAcEx
export PATH=~/.zsh/plugins/osx/lib:/usr/local/opt/ruby/bin:/usr/local/opt/ccache/libexec:/usr/local/bin:/usr/local/sbin:/usr/sbin:/sbin:$PATH
export NODE_PATH=/usr/local/share/npm/lib/node_modules
export GIT=/usr/local/bin/git
export JAVA_HOME="$(/usr/libexec/java_home)"
export EC2_HOME="/usr/local/Library/LinkedKegs/ec2-api-tools/jars"

## aliases
alias l='/bin/ls'
alias ls='ls -GF'
alias la='ls -AGF'
alias lsa='ls -AGF'
alias ll='ls -lhGF'
alias lla='ls -lhAGF'
alias lsla='ls -lhAGF'
alias lt='ls -lhtGF'
alias lta='ls -lhtAGF'
alias o=open
alias ql='qlmanage -p > /dev/null 2>&1'
alias topc='top -o cpu'
alias topm='top - vsize'
alias hdimount='hdiutil mount'
alias hdidetach='hdiutil detach'
alias forceeject='hdiutil detach -force'
alias cwd='pwd | pbcopy'
alias gowd='cd "`pbpaste`"'
alias airport='/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airPort'
alias xc='open *xcodeproj'
alias fs-usage='fs_usage -w -f filesys'
alias zombiefinder='/System/Library/CoreServices/Finder.app/Contents/MacOS/Finder &'
alias flushcache='sudo killall -HUP mDNSResponder'
alias lockscreen='/System/Library/CoreServices/Menu\ Extras/User.menu/Contents/Resources/CGSession -suspend'

# functions
update-visor() {
    # Create a copy of iTerm called iTermVisor which will run in background on login, only uses visor.
    local p='/Applications'
    cp -rf $p/iTerm.app $p/iTermVisor.app
    mv $p/iTermVisor.app/Contents/MacOS/iTerm $p/iTermVisor.app/Contents/MacOS/iTermVisor
    defaults write $p/iTermVisor.app/Contents/Info CFBundleIdentifier com.googlecode.iterm2visor
    defaults write $p/iTermVisor.app/Contents/Info CFBundleExecutable iTermVisor
    defaults write $p/iTermVisor.app/Contents/Info CFBundleName iTermVisor
    defaults write $p/iTermVisor.app/Contents/Info LSUIElement 1
    rm -rf ~$p/iTermVisor.app
    mv $p/iTermVisor.app ~$p
}

mavericks-hacks() {
    # disable prss and hhhhhold
    defaults write -g ApplePressAndHoldEnabled -bool false
    # do not write .DS_Store files on network drives
    defaults write com.apple.desktopservices DSDontWriteNetworkStores true
    # use new-style lists in dock
    defaults write com.apple.dock use-new-list-stack -bool true
    # allow airdrop to work over ethernet
    defaults write com.apple.NetworkBrowser BrowseAllInterfaces 1
    killall Dock
}

lion-hacks() {
    # Give me back key repeating
    defaults write -g ApplePressAndHoldEnabled -bool false
    # Increase key repeat speed
    defaults write NSGlobalDomain KeyRepeat -int 1
    # Disable window restore
    defaults write com.apple.Preview NSQuitAlwaysKeepsWindows -bool false
    defaults write com.apple.QuickTimePlayerX NSQuitAlwaysKeepsWindows -bool false
    defaults write com.apple.Safari ApplePersistenceIgnoreState -bool true
    # Disable lame animation when window opens
    defaults write NSGlobalDomain NSAutomaticWindowAnimationsEnabled -bool false
    # Use new list-style, cmd+/- to change icon size
    defaults write com.apple.dock use-new-list-stack -bool true
    # 2d dock plz
    defaults write com.apple.dock no-glass -bool true
    # Speed up sheets slide-in animation
    defaults write -g NSWindowResizeTime -float 0.01
    killall Dock
    defaults write com.apple.desktopservices DSDontWriteNetworkStores true
    # AirDrop over Ethernet
    defaults write com.apple.NetworkBrowser BrowseAllInterfaces 1
}

hide-spotlight() {
    sudo mv /System/Library/CoreServices/Search.bundle /System/Library/CoreServices/Search.bundle.bak
}

edit-keymapping() {
    # To modify keyboard mappings navigate to com.apple.keyboard.modifiermapping.* and swap keycodes:
    # None            1
    # Caps Lock       0
    # Shift (Left)    1
    # Control (Left)  2
    # Option (Left)   3
    # Command (Left)  4
    # Keypad 0        5
    # Help            6
    # Shift (Right)   9
    # Control (Right) 10
    # Option (Right)  11
    # Command (Right) 12

    open ~/Library/Preferences/ByHost/.GlobalPreferences.*.plist
}

dynamic-pager-enable() {
    sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.dynamic_pager.plist
    sudo rm -rf /var/vm/*
}

dynamic-pager-disable() {
    sudo launchctl load -wF /System/Library/LaunchDaemons/com.apple.dynamic_pager.plist
}

ps() {
    if [ $1 ]; then
        /bin/ps $@
    else
        ps ux -U `whoami`
    fi
}

last-modified() {
    stat -f '%m' $1
}

function vnc-enable() {
    sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -clientopts -setvnclegacy -vnclegacy yes -clientopts -setvncpw -vncpw mypasswd -restart -agent -privs -all
}

function vnc-disable() {
    sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -deactivate -configure -access -off
}

function reset-open-with() {
    /System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister -kill -r -domain local -domain system -domain user
}
