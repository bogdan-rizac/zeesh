hg-time-since() {
    local hgdir=".hg"
    local now=`date +%s`
    while [ ! -d "$hgdir" ]; do
        hgdir="../$hgdir"
    done
    if [ -f "$hgdir/undo.dirstate" ]; then
        eval `stat -s $hgdir/undo.dirstate`
    else
        local st_mtime=$now
    fi
    local since=$(( $now - $st_mtime ))
    if [[ $since -lt 3600 ]]; then
        echo $(( $since / 60 ))m
    elif [[ $since -lt 86400 ]]; then
        echo $(( $since / 3600 ))h
    else
        echo $(( $since / 86400 ))d
    fi
}
