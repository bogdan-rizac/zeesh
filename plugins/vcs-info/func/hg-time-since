hg-time-since() {
    local hgdir=".hg"
    local now=`date +%s`
    local last=$now
    while [ ! -d "$hgdir" ]; do
        hgdir="../$hgdir"
    done
    if [ -f "$hgdir/undo.dirstate" ]; then
        last=`last-modified $hgdir/undo.dirstate`
    fi
    local since=$(( $now - $last ))
    if [[ $since -lt 3600 ]]; then
        echo $(( $since / 60 ))m
    elif [[ $since -lt 86400 ]]; then
        echo $(( $since / 3600 ))h
    else
        echo $(( $since / 86400 ))d
    fi
}
